<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Vehicle Sensor Management System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                <div>
                    <h1>üöó Real-Time Vehicle Sensor Management System</h1>
                    <p>Interrupt-Driven RTOS Simulation with Priority Handling</p>
                </div>
                <a href="/ppt" class="btn btn-ppt" title="View PowerPoint Presentation">
                    üìä Export PPT
                </a>
            </div>
        </header>

        <!-- Sensor Control Panel -->
        <div class="control-panel">
            <h2>Sensor Event Simulator</h2>
            <div class="sensor-buttons">
                <button class="btn btn-brake" onclick="triggerSensor('Brake')">
                    üõë Brake Sensor<br><span class="priority">Priority: 7 (Highest)</span>
                </button>
                <button class="btn btn-collision" onclick="triggerSensor('Collision')">
                    ‚ö†Ô∏è Collision Sensor<br><span class="priority">Priority: 6 (High)</span>
                </button>
                <button class="btn btn-speed" onclick="triggerSensor('Speed')">
                    ‚ö° Speed Sensor<br><span class="priority">Priority: 5 (Medium)</span>
                </button>
                <button class="btn btn-all-sensors" onclick="triggerAllSensors()">
                    üö® ALL SENSORS<br><span class="priority">Execution: Brake ‚Üí Collision ‚Üí Speed</span>
                </button>
            </div>
        </div>

        <!-- Animated Car Visualization -->
        <div class="car-visualization">
            <h2>Vehicle Status Visualization</h2>
            <div class="car-content">
                <div class="car-section">
                    <div class="car-container">
                        <svg class="car-svg" viewBox="0 0 1000 500" xmlns="http://www.w3.org/2000/svg">
                            <!-- Definitions -->
                            <defs>
                                <!-- Sky gradient -->
                                <linearGradient id="skyGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style="stop-color:#87CEEB;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#E0F6FF;stop-opacity:1" />
                                </linearGradient>
                                <!-- Car body gradient - Bright Red Sports Car with highlights -->
                                <linearGradient id="carGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style="stop-color:#ff3333;stop-opacity:1" />
                                    <stop offset="30%" style="stop-color:#ff1a1a;stop-opacity:1" />
                                    <stop offset="70%" style="stop-color:#e60000;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#cc0000;stop-opacity:1" />
                                </linearGradient>
                                <!-- Car highlight gradient for top surface -->
                                <linearGradient id="carHighlight" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style="stop-color:#ff6666;stop-opacity:0.6" />
                                    <stop offset="50%" style="stop-color:#ff3333;stop-opacity:0.3" />
                                    <stop offset="100%" style="stop-color:#ff0000;stop-opacity:0" />
                                </linearGradient>
                                <!-- White wheel gradient -->
                                <linearGradient id="whiteWheelGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#ffffff;stop-opacity:1" />
                                    <stop offset="50%" style="stop-color:#f8f8f8;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#e8e8e8;stop-opacity:1" />
                                </linearGradient>
                                <!-- Wheel shadow gradient -->
                                <radialGradient id="wheelShadow" cx="50%" cy="50%">
                                    <stop offset="0%" style="stop-color:#2a2a2a;stop-opacity:1" />
                                    <stop offset="70%" style="stop-color:#1a1a1a;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#0a0a0a;stop-opacity:1" />
                                </radialGradient>
                                <!-- Chrome gradient -->
                                <linearGradient id="chromeGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#e8e8e8;stop-opacity:1" />
                                    <stop offset="50%" style="stop-color:#ffffff;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#c0c0c0;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            
                            <!-- Sky background -->
                            <rect width="1000" height="500" fill="url(#skyGradient)"/>
                            
                            <!-- Clouds (animated) -->
                            <g class="cloud-animated">
                                <ellipse cx="100" cy="50" rx="40" ry="20" fill="#fff" opacity="0.7"/>
                                <ellipse cx="130" cy="45" rx="35" ry="18" fill="#fff" opacity="0.7"/>
                                <ellipse cx="70" cy="45" rx="30" ry="15" fill="#fff" opacity="0.7"/>
                            </g>
                            <g class="cloud-animated cloud-2">
                                <ellipse cx="800" cy="80" rx="45" ry="22" fill="#fff" opacity="0.6"/>
                                <ellipse cx="835" cy="75" rx="38" ry="20" fill="#fff" opacity="0.6"/>
                                <ellipse cx="765" cy="75" rx="32" ry="17" fill="#fff" opacity="0.6"/>
                            </g>
                            
                            <!-- Trees (left side, animated) -->
                            <g class="trees-animated">
                                <!-- Tree 1 -->
                                <rect x="30" y="140" width="15" height="60" fill="#8B4513"/>
                                <circle cx="37.5" cy="120" r="35" fill="#228B22"/>
                                <!-- Tree 2 -->
                                <rect x="120" y="100" width="12" height="80" fill="#8B4513"/>
                                <circle cx="126" cy="75" r="40" fill="#27AE60"/>
                            </g>
                            
                            <!-- Trees (right side, animated) -->
                            <g class="trees-animated-right">
                                <!-- Tree 3 -->
                                <rect x="940" y="130" width="15" height="70" fill="#8B4513"/>
                                <circle cx="947.5" cy="110" r="38" fill="#228B22"/>
                                <!-- Tree 4 -->
                                <rect x="870" y="90" width="13" height="90" fill="#8B4513"/>
                                <circle cx="876.5" cy="60" r="42" fill="#27AE60"/>
                            </g>
                            
                            <!-- Street Lights (left side, animated) -->
                            <g class="streetlight-animated">
                                <!-- Street light 1 pole -->
                                <rect x="60" y="220" width="8" height="100" fill="#333"/>
                                <!-- Street light 1 head -->
                                <rect x="45" y="210" width="38" height="25" rx="4" fill="#FFD700"/>
                                <circle cx="64" cy="222" r="8" fill="#FFEB3B" opacity="0.9"/>
                                <!-- Street light 2 pole -->
                                <rect x="240" y="210" width="8" height="110" fill="#333"/>
                                <!-- Street light 2 head -->
                                <rect x="225" y="200" width="38" height="25" rx="4" fill="#FFD700"/>
                                <circle cx="244" cy="212" r="8" fill="#FFEB3B" opacity="0.9"/>
                            </g>
                            
                            <!-- Street Lights (right side, animated) -->
                            <g class="streetlight-animated-right">
                                <!-- Street light 3 pole -->
                                <rect x="920" y="230" width="8" height="90" fill="#333"/>
                                <!-- Street light 3 head -->
                                <rect x="905" y="220" width="38" height="25" rx="4" fill="#FFD700"/>
                                <circle cx="924" cy="232" r="8" fill="#FFEB3B" opacity="0.9"/>
                                <!-- Street light 4 pole -->
                                <rect x="740" y="215" width="8" height="105" fill="#333"/>
                                <!-- Street light 4 head -->
                                <rect x="725" y="205" width="38" height="25" rx="4" fill="#FFD700"/>
                                <circle cx="744" cy="217" r="8" fill="#FFEB3B" opacity="0.9"/>
                            </g>
                            
                            <!-- Road -->
                            <rect x="0" y="320" width="1000" height="200" fill="#3a3a3a" stroke="#1a1a1a" stroke-width="3"/>
                            
                            <!-- Road shadow for depth -->
                            <rect x="0" y="510" width="1000" height="10" fill="#000" opacity="0.2"/>
                            
                            <!-- Road markings (dashed center line - animated) -->
                            <g class="road-markings-animated">
                                <line x1="0" y1="415" x2="1000" y2="415" stroke="#ffeb3b" stroke-width="4" stroke-dasharray="40,30"/>
                                <line x1="0" y1="425" x2="1000" y2="425" stroke="#ffeb3b" stroke-width="2" stroke-dasharray="40,30" opacity="0.4"/>
                            </g>
                            
                            <!-- Distance markers -->
                            <line x1="50" y1="500" x2="50" y2="520" stroke="#fff" stroke-width="3"/>
                            <line x1="250" y1="500" x2="250" y2="520" stroke="#fff" stroke-width="3"/>
                            <line x1="500" y1="500" x2="500" y2="520" stroke="#fff" stroke-width="3"/>
                            <line x1="750" y1="500" x2="750" y2="520" stroke="#fff" stroke-width="3"/>
                            <line x1="950" y1="500" x2="950" y2="520" stroke="#fff" stroke-width="3"/>
                            
                            <!-- Car Group - Sleek Red Sports Car (Low Profile) -->
                            <g id="car-group" class="car-static">
                                <!-- Shadow under car -->
                                <ellipse cx="500" cy="430" rx="320" ry="12" fill="#000" opacity="0.25"/>
                                
                                <!-- Main body - MUCH LOWER, sleeker sports car -->
                                <path d="M 200 380 L 260 320 L 740 320 L 800 380 Z" fill="url(#carGradient)" stroke="#990000" stroke-width="1" stroke-linejoin="round"/>
                                
                                <!-- Body highlight -->
                                <path d="M 260 320 L 320 290 L 680 290 L 740 320 Z" fill="url(#carHighlight)" stroke="none"/>
                                
                                <!-- Side body panel - Lower and sleeker -->
                                <path d="M 260 320 L 300 285 L 700 285 L 740 320 Z" fill="url(#carGradient)" stroke="#990000" stroke-width="1" stroke-linejoin="round"/>
                                
                                <!-- Roof section - VERY LOW profile (sports car) -->
                                <path d="M 320 285 L 340 255 L 660 255 L 680 285 Z" fill="url(#carGradient)" stroke="#990000" stroke-width="1"/>
                                
                                <!-- Roof highlight -->
                                <path d="M 340 260 L 660 260 L 675 285 L 325 285 Z" fill="url(#carHighlight)" stroke="none"/>
                                
                                <!-- Front windshield - Dark tinted, more angled -->
                                <path d="M 340 260 L 380 285 L 620 285 L 660 260 Z" fill="#0a0a0a" stroke="#000" stroke-width="1.5" opacity="0.9"/>
                                <path d="M 345 265 L 380 285 L 620 285 L 655 265 Z" fill="#1a1a1a" stroke="none" opacity="0.7"/>
                                <!-- Windshield reflection -->
                                <path d="M 360 270 L 400 285 L 600 285 L 640 270 Z" fill="#ffffff" stroke="none" opacity="0.12"/>
                                
                                <!-- Rear window - Dark tinted, smaller -->
                                <path d="M 620 285 L 640 320 L 680 320 L 660 285 Z" fill="#0a0a0a" stroke="#000" stroke-width="1.5" opacity="0.9"/>
                                <path d="M 625 290 L 640 320 L 675 320 L 660 290 Z" fill="#1a1a1a" stroke="none" opacity="0.7"/>
                                
                                <!-- Front bumper - Lower and sleeker -->
                                <path d="M 200 380 L 220 390 L 780 390 L 800 380 Z" fill="#0a0a0a" stroke="#1a1a1a" stroke-width="1"/>
                                
                                <!-- Front splitter - Subtle -->
                                <path d="M 220 390 L 780 390 L 785 392 L 215 392 Z" fill="#1a1a1a" stroke="#333" stroke-width="0.5"/>
                                
                                <!-- Front air intake/grille - Lower profile -->
                                <path d="M 300 375 L 700 375 L 695 385 L 305 385 Z" fill="#0a0a0a" stroke="#333" stroke-width="1"/>
                                <!-- Grille lines -->
                                <line x1="350" y1="375" x2="350" y2="385" stroke="#333" stroke-width="0.8"/>
                                <line x1="450" y1="375" x2="450" y2="385" stroke="#333" stroke-width="0.8"/>
                                <line x1="550" y1="375" x2="550" y2="385" stroke="#333" stroke-width="0.8"/>
                                <line x1="650" y1="375" x2="650" y2="385" stroke="#333" stroke-width="0.8"/>
                                
                                <!-- Headlights - Sleek, lower position with interactive classes -->
                                <ellipse cx="220" cy="345" rx="14" ry="18" fill="#000" stroke="#333" stroke-width="1.5"/>
                                <ellipse cx="220" cy="345" rx="10" ry="14" fill="#ffeb3b" class="headlight" opacity="0.95"/>
                                <ellipse cx="220" cy="345" rx="6" ry="8" fill="#fff9c4" class="headlight" opacity="0.8"/>
                                <ellipse cx="220" cy="345" rx="3" ry="5" fill="#ffffff" class="headlight" opacity="0.9"/>
                                
                                <ellipse cx="780" cy="345" rx="14" ry="18" fill="#000" stroke="#333" stroke-width="1.5"/>
                                <ellipse cx="780" cy="345" rx="10" ry="14" fill="#ffeb3b" class="headlight" opacity="0.95"/>
                                <ellipse cx="780" cy="345" rx="6" ry="8" fill="#fff9c4" class="headlight" opacity="0.8"/>
                                <ellipse cx="780" cy="345" rx="3" ry="5" fill="#ffffff" class="headlight" opacity="0.9"/>
                                
                                <!-- Rear brake lights - Sleeker design -->
                                <rect x="185" y="335" width="18" height="28" rx="3" fill="#000" stroke="#333" stroke-width="1.5"/>
                                <rect x="190" y="340" width="8" height="6" fill="#ff0000" class="brake-light" opacity="0.5"/>
                                <rect x="190" y="350" width="8" height="6" fill="#ff0000" class="brake-light" opacity="0.5"/>
                                
                                <rect x="797" y="335" width="18" height="28" rx="3" fill="#000" stroke="#333" stroke-width="1.5"/>
                                <rect x="802" y="340" width="8" height="6" fill="#ff0000" class="brake-light" opacity="0.5"/>
                                <rect x="802" y="350" width="8" height="6" fill="#ff0000" class="brake-light" opacity="0.5"/>
                                
                                <!-- Collision Warning Lights (Emergency Flashers) -->
                                <circle cx="200" cy="300" r="4" fill="#ff6600" class="warning-light" opacity="0"/>
                                <circle cx="800" cy="300" r="4" fill="#ff6600" class="warning-light" opacity="0"/>
                                
                                <!-- Speed Indicator Arrows -->
                                <g class="speed-indicator" opacity="0">
                                    <path d="M 820 350 L 860 350 L 840 380 Z" fill="#00ff00" opacity="0.8"/>
                                    <path d="M 830 370 L 870 370 L 850 400 Z" fill="#00ff00" opacity="0.6"/>
                                    <path d="M 840 390 L 880 390 L 860 420 Z" fill="#00ff00" opacity="0.4"/>
                                </g>
                                
                                <!-- Body side line - Elegant accent -->
                                <path d="M 300 295 L 700 295" stroke="#ff6666" stroke-width="2" opacity="0.5" stroke-linecap="round"/>
                                
                                <!-- Side air vent - Subtle -->
                                <path d="M 400 300 L 415 292 L 430 300 L 415 308 Z" fill="#0a0a0a" stroke="#333" stroke-width="0.8" opacity="0.7"/>
                                
                                <!-- Door line - Very subtle -->
                                <line x1="360" y1="295" x2="360" y2="320" stroke="#990000" stroke-width="0.8" opacity="0.25"/>
                                <line x1="640" y1="295" x2="640" y2="320" stroke="#990000" stroke-width="0.8" opacity="0.25"/>
                                
                                <!-- Side mirrors - Sleeker, lower -->
                                <path d="M 300 270 L 312 267 L 312 278 L 300 281 Z" fill="#1a1a1a" stroke="#000" stroke-width="1"/>
                                <circle cx="306" cy="274" r="3" fill="#0a0a0a" opacity="0.9"/>
                                
                                <path d="M 688 270 L 700 267 L 700 278 L 688 281 Z" fill="#1a1a1a" stroke="#000" stroke-width="1"/>
                                <circle cx="694" cy="274" r="3" fill="#0a0a0a" opacity="0.9"/>
                                
                                <!-- REAR SPOILER - Sleek sports car style -->
                                <path d="M 180 320 L 200 300 L 200 275 L 220 275 L 220 300 L 200 320 Z" fill="url(#carGradient)" stroke="#990000" stroke-width="1.5"/>
                                <path d="M 200 300 L 220 275 L 220 300 L 200 320" fill="#cc0000" opacity="0.8"/>
                                <!-- Spoiler top edge highlight -->
                                <line x1="200" y1="275" x2="220" y2="275" stroke="#ff3333" stroke-width="1" opacity="0.6"/>
                                <!-- Spoiler supports -->
                                <rect x="205" y="275" width="3" height="25" fill="#1a1a1a"/>
                                <rect x="217" y="275" width="3" height="25" fill="#1a1a1a"/>
                                
                                <!-- Sports car wheels - WHITE with RED center caps (smaller, proportional) -->
                                <g>
                                    <!-- Left wheel - White 5-spoke -->
                                    <circle cx="360" cy="395" r="36" fill="url(#wheelShadow)"/>
                                    <circle cx="360" cy="395" r="30" fill="#0a0a0a" stroke="#1a1a1a" stroke-width="2"/>
                                    <circle cx="360" cy="395" r="25" fill="#1a1a1a"/>
                                    <!-- White rim -->
                                    <circle cx="360" cy="395" r="24" fill="url(#whiteWheelGradient)" stroke="#ddd" stroke-width="1"/>
                                    <circle cx="360" cy="395" r="20" fill="#ffffff" opacity="0.9"/>
                                    <!-- 5-spoke design in white -->
                                    <line x1="360" y1="359" x2="360" y2="431" stroke="#ffffff" stroke-width="3.5" stroke-linecap="round"/>
                                    <line x1="324" y1="395" x2="396" y2="395" stroke="#ffffff" stroke-width="3.5" stroke-linecap="round"/>
                                    <line x1="336" y1="367" x2="384" y2="423" stroke="#ffffff" stroke-width="3.5" stroke-linecap="round"/>
                                    <line x1="384" y1="367" x2="336" y2="423" stroke="#ffffff" stroke-width="3.5" stroke-linecap="round"/>
                                    <!-- RED center cap with white star -->
                                    <circle cx="360" cy="395" r="11" fill="#cc0000" stroke="#990000" stroke-width="1.5"/>
                                    <circle cx="360" cy="395" r="7" fill="#ffffff" opacity="0.2"/>
                                    <!-- Star pattern -->
                                    <path d="M 360 389 L 361.5 395 L 367 395 L 362.5 398.5 L 364.5 404 L 360 400.5 L 355.5 404 L 357.5 398.5 L 353 395 L 358.5 395 Z" fill="#ffffff" opacity="0.9"/>
                                    
                                    <!-- Right wheel - White 5-spoke -->
                                    <circle cx="640" cy="395" r="36" fill="url(#wheelShadow)"/>
                                    <circle cx="640" cy="395" r="30" fill="#0a0a0a" stroke="#1a1a1a" stroke-width="2"/>
                                    <circle cx="640" cy="395" r="25" fill="#1a1a1a"/>
                                    <!-- White rim -->
                                    <circle cx="640" cy="395" r="24" fill="url(#whiteWheelGradient)" stroke="#ddd" stroke-width="1"/>
                                    <circle cx="640" cy="395" r="20" fill="#ffffff" opacity="0.9"/>
                                    <!-- 5-spoke design in white -->
                                    <line x1="640" y1="359" x2="640" y2="431" stroke="#ffffff" stroke-width="3.5" stroke-linecap="round"/>
                                    <line x1="604" y1="395" x2="676" y2="395" stroke="#ffffff" stroke-width="3.5" stroke-linecap="round"/>
                                    <line x1="616" y1="367" x2="664" y2="423" stroke="#ffffff" stroke-width="3.5" stroke-linecap="round"/>
                                    <line x1="664" y1="367" x2="616" y2="423" stroke="#ffffff" stroke-width="3.5" stroke-linecap="round"/>
                                    <!-- RED center cap with white star -->
                                    <circle cx="640" cy="395" r="11" fill="#cc0000" stroke="#990000" stroke-width="1.5"/>
                                    <circle cx="640" cy="395" r="7" fill="#ffffff" opacity="0.2"/>
                                    <!-- Star pattern -->
                                    <path d="M 640 389 L 641.5 395 L 647 395 L 642.5 398.5 L 644.5 404 L 640 400.5 L 635.5 404 L 637.5 398.5 L 633 395 L 638.5 395 Z" fill="#ffffff" opacity="0.9"/>
                                </g>
                                
                                <!-- Body reflection/highlight on side -->
                                <path d="M 300 295 L 700 295 L 695 300 L 305 300 Z" fill="#ffffff" opacity="0.08"/>
                            </g>
                            
                            <!-- Speed indicator (motion arrows) -->
                            <g class="speed-indicator" opacity="0">
                                <path d="M 820 310 L 880 310 L 850 360 Z" fill="#4CAF50" opacity="0.9"/>
                                <path d="M 820 340 L 880 340 L 850 390 Z" fill="#4CAF50" opacity="0.9"/>
                            </g>
                        </svg>
                    </div>
                    
                    <!-- Status Display Below Car -->
                    <div class="car-status-display">
                        <div class="status-indicator">
                            <span class="status-label">Speed:</span>
                            <span class="status-value" id="speed">0 km/h</span>
                        </div>
                        <div class="status-indicator">
                            <span class="status-label">Brake:</span>
                            <span class="status-value" id="brake" class="brake-off">Off</span>
                        </div>
                        <div class="status-indicator">
                            <span class="status-label">Collision:</span>
                            <span class="status-value" id="collision" class="safe">Safe</span>
                        </div>
                    </div>
                </div>
                
                <!-- System Logs Panel (Right Side) -->
                <div class="system-logs-panel">
                    <div class="logs-header">
                        <h3>üìã System Events</h3>
                        <div class="logs-header-buttons">
                            <button class="logs-download-btn" onclick="downloadLogs()" title="Download logs as text file">
                                <span>‚¨áÔ∏è Download</span>
                            </button>
                            <button class="logs-clear-btn" onclick="document.getElementById('system-events-log').innerHTML=''">Clear</button>
                        </div>
                    </div>
                    <div class="system-events-log" id="system-events-log">
                        <div class="log-item info">
                            <span class="log-time">00:00:00</span>
                            <span class="log-msg">System initialized</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Statistics Dashboard -->
        <div class="stats-dashboard">
            <h2>üìä System Statistics</h2>
            <div class="stats-grid-main">
                <!-- Event Statistics -->
                <div class="stat-card">
                    <h3>Event Statistics</h3>
                    <div class="stat-content">
                        <div class="stat-row">
                            <span class="stat-name">Brake Events (P7):</span>
                            <span class="stat-value" id="brake-events">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-name">Collision Events (P6):</span>
                            <span class="stat-value" id="collision-events">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-name">Speed Events (P5):</span>
                            <span class="stat-value" id="speed-events">0</span>
                        </div>
                        <div class="stat-row total">
                            <span class="stat-name">Total Events:</span>
                            <span class="stat-value" id="total-events">0</span>
                        </div>
                    </div>
                </div>

                <!-- Interrupt Statistics -->
                <div class="stat-card">
                    <h3>Interrupt Handling</h3>
                    <div class="stat-content">
                        <div class="stat-row">
                            <span class="stat-name">Total Interrupts:</span>
                            <span class="stat-value" id="total-interrupts">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-name">Interrupts/Second:</span>
                            <span class="stat-value" id="interrupts-per-sec">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-name">Avg Response Time:</span>
                            <span class="stat-value" id="avg-response-time">0 ms</span>
                        </div>
                    </div>
                </div>

                <!-- System Information -->
                <div class="stat-card">
                    <h3>System Information</h3>
                    <div class="stat-content">
                        <div class="stat-row">
                            <span class="stat-name">System Uptime:</span>
                            <span class="stat-value" id="system-uptime">00:00:00</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-name">CPU Load:</span>
                            <span class="stat-value" id="cpu-load">0%</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-name">Status:</span>
                            <span class="stat-value status-running" id="system-status">üü¢ Running</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Control Buttons -->
        <div class="controls">
            <button id="refreshBtn" class="btn btn-primary">Manual Refresh</button>
            <button id="pauseBtn" class="btn btn-secondary">Pause System</button>
            <button id="clearBtn" class="btn btn-secondary">Reset Dashboard</button>
        </div>
    </div>

    <script>
        let lastLogCount = 0;
        let isRefreshing = false;
        let isPaused = false;

        // Smooth log refresh without shaking
        async function refreshLogs() {
            if (isRefreshing) return;
            isRefreshing = true;

            try {
                const response = await fetch('/api/event-log');
                const data = await response.json();
                
                if (data.events && data.events.length !== lastLogCount) {
                    const logContainer = document.getElementById('system-events-log');
                    if (logContainer) {
                        // Only update if there are new logs
                        logContainer.innerHTML = '';
                        
                        // Show ALL events, most recent first
                        data.events.slice().reverse().forEach(event => {
                            const entry = document.createElement('div');
                            entry.className = 'log-item info';
                            
                            // Extract timestamp
                            const timestampMatch = event.match(/\[(\d+)\]/);
                            const timestamp = timestampMatch ? timestampMatch[1] : '';
                            
                            // Format time (microseconds to readable)
                            const displayTime = timestamp ? 
                                new Date(parseInt(timestamp) / 1000).toLocaleTimeString() + '.' + 
                                (parseInt(timestamp) % 1000000).toString().padStart(6, '0') : 
                                new Date().toLocaleTimeString();
                            
                            // Create priority badge
                            let badge = '';
                            if (event.includes('Brake')) badge = '<span class="priority-badge p7">[P7]</span>';
                            else if (event.includes('Collision')) badge = '<span class="priority-badge p6">[P6]</span>';
                            else if (event.includes('Speed')) badge = '<span class="priority-badge p5">[P5]</span>';
                            else if (event.includes('ISR_')) badge = '<span class="priority-badge isr">[ISR]</span>';
                            else if (event.includes('TASK_')) badge = '<span class="priority-badge task">[TASK]</span>';
                            else if (event.includes('PREEMPT')) badge = '<span class="priority-badge preempt">[PREEMPT]</span>';
                            
                            entry.innerHTML = `
                                <span class="log-time">${displayTime}</span>
                                ${badge}
                                <span class="log-msg">${event.replace(/\[\d+\]\s*/, '')}</span>
                            `;
                            
                            logContainer.appendChild(entry);
                        });
                        
                        lastLogCount = data.events.length;
                    }
                }
            } catch (error) {
                console.error('Error refreshing logs:', error);
            } finally {
                isRefreshing = false;
            }
        }

        // Trigger sensor function with car animations
        async function triggerSensor(sensorName) {
            try {
                console.log(`Triggering ${sensorName}...`);
                
                // Add visual feedback to button
                const buttons = {
                    'Brake': '.btn-brake',
                    'Collision': '.btn-collision',
                    'Speed': '.btn-speed'
                };
                
                const btnElement = document.querySelector(buttons[sensorName]);
                if (btnElement) {
                    btnElement.classList.add('active');
                    setTimeout(() => btnElement.classList.remove('active'), 300);
                }
                
                // Animate car based on sensor
                animateCarForSensor(sensorName);
                
                const response = await fetch(`/api/trigger-sensor/${sensorName}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                console.log('Trigger result:', result);
                
                // Refresh logs and statistics after a short delay
                setTimeout(() => {
                    refreshLogs();
                    updateStatistics();
                }, 300);
                
            } catch (error) {
                console.error('Error triggering sensor:', error);
            }
        }

        // Animate car based on sensor type
        function animateCarForSensor(sensorName) {
            if (sensorName === 'Brake') {
                // Activate brake lights
                const brakeLights = document.querySelectorAll('.brake-light');
                brakeLights.forEach(light => {
                    light.style.opacity = '1';
                    light.style.filter = 'drop-shadow(0 0 8px #ff0000)';
                });
                
                // Update status
                updateCarStatus('brake', 'On', 'brake-on');
                
                // Turn off after 3 seconds
                setTimeout(() => {
                    brakeLights.forEach(light => {
                        light.style.opacity = '0.5';
                        light.style.filter = 'none';
                    });
                    updateCarStatus('brake', 'Off', 'brake-off');
                }, 3000);
                
            } else if (sensorName === 'Collision') {
                // Flash warning lights for collision
                const warningLights = document.querySelectorAll('.warning-light');
                let flashCount = 0;
                const flashInterval = setInterval(() => {
                    warningLights.forEach(light => {
                        light.style.opacity = light.style.opacity === '0' ? '1' : '0';
                    });
                    flashCount++;
                    if (flashCount >= 8) {
                        clearInterval(flashInterval);
                        warningLights.forEach(light => {
                            light.style.opacity = '0';
                        });
                    }
                }, 250);
                
                // Also flash headlights briefly
                const headlights = document.querySelectorAll('.headlight');
                setTimeout(() => {
                    headlights.forEach(light => {
                        light.style.filter = 'brightness(2)';
                    });
                    setTimeout(() => {
                        headlights.forEach(light => {
                            light.style.filter = 'none';
                        });
                    }, 500);
                }, 100);
                
                // Update status
                updateCarStatus('collision', 'Warning!', 'warning');
                setTimeout(() => updateCarStatus('collision', 'Safe', 'safe'), 4000);
                
            } else if (sensorName === 'Speed') {
                // Show speed indicator
                const speedIndicator = document.querySelector('.speed-indicator');
                if (speedIndicator) {
                    speedIndicator.style.opacity = '1';
                    setTimeout(() => speedIndicator.style.opacity = '0', 2000);
                }
                
                // Update speed
                updateCarStatus('speed', '60 km/h', 'speed');
                setTimeout(() => updateCarStatus('speed', '0 km/h', ''), 3000);
            }
        }

        // Update car status display
        function updateCarStatus(property, value, className) {
            const element = document.getElementById(property);
            if (element) {
                element.textContent = value;
                element.className = `status-value ${className}`;
                
                // Add visual emphasis for status changes
                element.style.transform = 'scale(1.1)';
                element.style.transition = 'all 0.3s ease';
                setTimeout(() => {
                    element.style.transform = 'scale(1)';
                }, 300);
            }
        }

        // Trigger all sensors to demonstrate priority scheduling
        async function triggerAllSensors() {
            try {
                console.log('üö® TRIGGERING ALL SENSORS - Priority Demo Starting...');
                
                // Add visual feedback to the all-sensors button
                const allSensorsBtn = document.querySelector('.btn-all-sensors');
                if (allSensorsBtn) {
                    allSensorsBtn.classList.add('active');
                    setTimeout(() => allSensorsBtn.classList.remove('active'), 2000);
                }
                
                // Add explanation message without clearing logs
                const logContainer = document.getElementById('system-events-log');
                if (logContainer) {
                    const explanationEntry = document.createElement('div');
                    explanationEntry.className = 'log-item info';
                    explanationEntry.innerHTML = `
                        <span class="log-time">${new Date().toLocaleTimeString()}</span>
                        <span class="priority-badge preempt">[DEMO]</span>
                        <span class="log-msg">üö® PRIORITY DEMO: Triggering all sensors - Brake‚ÜíCollision‚ÜíSpeed</span>
                    `;
                    logContainer.insertBefore(explanationEntry, logContainer.firstChild);
                }
                
                // Trigger sensors in priority order: Brake (P7) ‚Üí Collision (P6) ‚Üí Speed (P5)
                console.log('Triggering Brake (P7) first...');
                triggerSensor('Brake');
                
                setTimeout(() => {
                    console.log('Triggering Collision (P6) second...');
                    triggerSensor('Collision');
                }, 500);
                
                setTimeout(() => {
                    console.log('Triggering Speed (P5) third...');
                    triggerSensor('Speed');
                }, 1000);
                
                // Add completion message after all sensors are triggered
                setTimeout(() => {
                    const logContainer = document.getElementById('system-events-log');
                    if (logContainer) {
                        const completionEntry = document.createElement('div');
                        completionEntry.className = 'log-item info';
                        completionEntry.innerHTML = `
                            <span class="log-time">${new Date().toLocaleTimeString()}</span>
                            <span class="priority-badge preempt">[DEMO]</span>
                            <span class="log-msg">‚úÖ DEMO COMPLETE: All sensors executed in priority order - Brake(P7) ‚Üí Collision(P6) ‚Üí Speed(P5)</span>
                        `;
                        logContainer.insertBefore(completionEntry, logContainer.firstChild);
                    }
                }, 2500);
                
                console.log('üéØ Priority demo complete - Check logs to see execution order!');
                
            } catch (error) {
                console.error('Error in priority demo:', error);
            }
        }

        // Download logs function
        function downloadLogs() {
            const log = document.getElementById('system-events-log').innerText;
            const blob = new Blob([log], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'rtos_event_log.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Fetch and update statistics
        async function updateStatistics() {
            try {
                const response = await fetch('/api/system-stats');
                const stats = await response.json();
                
                // Update event statistics
                const brakeEventsEl = document.getElementById('brake-events');
                const collisionEventsEl = document.getElementById('collision-events');
                const speedEventsEl = document.getElementById('speed-events');
                const totalEventsEl = document.getElementById('total-events');
                
                if (brakeEventsEl) brakeEventsEl.textContent = stats.brake_events || 0;
                if (collisionEventsEl) collisionEventsEl.textContent = stats.collision_events || 0;
                if (speedEventsEl) speedEventsEl.textContent = stats.speed_events || 0;
                if (totalEventsEl) totalEventsEl.textContent = stats.total_events || 0;
                
                // Update interrupt statistics
                const totalInterruptsEl = document.getElementById('total-interrupts');
                const interruptsPerSecEl = document.getElementById('interrupts-per-sec');
                const avgResponseTimeEl = document.getElementById('avg-response-time');
                
                if (totalInterruptsEl) totalInterruptsEl.textContent = stats.total_interrupts || 0;
                if (interruptsPerSecEl) interruptsPerSecEl.textContent = stats.interrupts_per_sec || 0;
                if (avgResponseTimeEl) avgResponseTimeEl.textContent = (stats.avg_response_time || 0) + ' Œºs';
                
                // Update system information
                const systemUptimeEl = document.getElementById('system-uptime');
                const cpuLoadEl = document.getElementById('cpu-load');
                const systemStatusEl = document.getElementById('system-status');
                
                if (systemUptimeEl) {
                    const uptime = stats.uptime || 0;
                    const hours = Math.floor(uptime / 3600).toString().padStart(2, '0');
                    const minutes = Math.floor((uptime % 3600) / 60).toString().padStart(2, '0');
                    const seconds = Math.floor(uptime % 60).toString().padStart(2, '0');
                    systemUptimeEl.textContent = `${hours}:${minutes}:${seconds}`;
                }
                if (cpuLoadEl) cpuLoadEl.textContent = (stats.cpu_usage || 0) + '%';
                if (systemStatusEl) systemStatusEl.textContent = stats.status || 'üü¢ Running';
                
            } catch (error) {
                console.error('Error fetching statistics:', error);
            }
        }

        // Setup all buttons
        document.addEventListener('DOMContentLoaded', () => {
            // Setup logs clear button
            const logsClearBtn = document.querySelector('.logs-clear-btn');
            if (logsClearBtn) {
                logsClearBtn.addEventListener('click', async () => {
                    try {
                        await fetch('/api/clear-log', { method: 'POST' });
                        const logContainer = document.getElementById('system-events-log');
                        if (logContainer) {
                            logContainer.innerHTML = '<div class="log-item info"><span class="log-time">00:00:00</span><span class="log-msg">Logs cleared</span></div>';
                        }
                        lastLogCount = 0;
                    } catch (error) {
                        console.error('Error clearing logs:', error);
                    }
                });
            }

            // Setup control buttons
            const refreshBtn = document.getElementById('refreshBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const resetBtn = document.getElementById('clearBtn');
            
            if (refreshBtn) {
                refreshBtn.addEventListener('click', () => {
                    refreshLogs();
                    updateStatistics();
                    console.log('Manual refresh executed');
                });
            }
            
            if (pauseBtn) {
                pauseBtn.addEventListener('click', () => {
                    isPaused = !isPaused;
                    if (isPaused) {
                        pauseBtn.textContent = 'Resume System';
                        pauseBtn.style.background = '#ef4444';
                        pauseBtn.style.color = 'white';
                        console.log('System paused');
                    } else {
                        pauseBtn.textContent = 'Pause System';
                        pauseBtn.style.background = '';
                        pauseBtn.style.color = '';
                        console.log('System resumed');
                    }
                });
            }
            
            if (resetBtn) {
                resetBtn.addEventListener('click', async () => {
                    if (confirm('Are you sure you want to reset the dashboard? All logs and statistics will be cleared.')) {
                        try {
                            // Clear backend logs
                            await fetch('/api/clear-log', { method: 'POST' });
                            
                            // Clear frontend display
                            const logContainer = document.getElementById('system-events-log');
                            if (logContainer) {
                                logContainer.innerHTML = '<div class="log-item info"><span class="log-time">00:00:00</span><span class="log-msg">Dashboard reset - System cleared</span></div>';
                            }
                            
                            // Reset car status
                            updateCarStatus('speed', '0 km/h', '');
                            updateCarStatus('brake', 'Off', 'brake-off');
                            updateCarStatus('collision', 'Safe', 'safe');
                            
                            // Reset statistics
                            const statsElements = [
                                'brake-events', 'collision-events', 'speed-events', 'total-events',
                                'total-interrupts', 'interrupts-per-sec', 'avg-response-time',
                                'system-uptime', 'cpu-load'
                            ];
                            
                            statsElements.forEach(id => {
                                const element = document.getElementById(id);
                                if (element) {
                                    if (id.includes('uptime')) element.textContent = '00:00:00';
                                    else if (id.includes('response-time')) element.textContent = '0 Œºs';
                                    else if (id.includes('cpu-load')) element.textContent = '0%';
                                    else element.textContent = '0';
                                }
                            });
                            
                            lastLogCount = 0;
                            console.log('Dashboard reset successfully');
                            
                        } catch (error) {
                            console.error('Error resetting dashboard:', error);
                            alert('Error resetting dashboard. Please try again.');
                        }
                    }
                });
            }

            // Initial load
            refreshLogs();
            updateStatistics();
            
            // Gentle auto-refresh every 3 seconds (less frequent to reduce shaking)
            setInterval(() => {
                if (!isRefreshing && !isPaused) {
                    refreshLogs();
                    updateStatistics();
                }
            }, 3000);
            
            // Debug: Log that everything is loaded
            console.log('Dashboard loaded successfully - all buttons should work now');
        });
    </script>
</body>
</html>
